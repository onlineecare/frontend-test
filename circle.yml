# IMPORTANT PREREQUISITES
#
# • "CircleCI" user needs to be created on AWS with the following policies attached:
#   - AmazonEC2ContainerRegistryPowerUser
#   - AmazonS3ReadOnlyAccess
#
# • Following environment variables need to be set on CircleCI
#   - DOCKER_REGISTRY_URL
#   - KUBERNETES_CONFIG_PASSWORD_DEV
#   - KUBERNETES_CONFIG_PASSWORD_CANARY
#   - KUBERNETES_CONFIG_PASSWORD_PROD
#   - AWS_ACCESS_KEY_ID
#   - AWS_SECRET_ACCESS_KEY
#
# • Kubernetes cluster needs to have been created
# • ~/.kube/config needs to have been put into a S3 bucket (KUBERNETES_CONFIG_STORE)

machine:
  services:
    - docker

  environment:
    DOCKER_REGISTRY_URL: 606042811316.dkr.ecr.us-west-2.amazonaws.com
    KUBERNETES_SERVICE_NAME: lumiere-docker-images

dependencies:
  cache_directories:
    - ~/.kube
  #pre:
    #- chmod 0777 ensure-kubernetes-is-installed.sh
    #- ./ensure-kubernetes-is-installed.sh

deployment:
  dev:
    branch: sprint[1-6]
    commands:
      - ./test.sh
